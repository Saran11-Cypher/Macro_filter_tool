<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Editor - Tabs</title>
    
    <!-- Handsontable CSS & JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@12.1.0/dist/handsontable.full.min.css">
    <script src="https://cdn.jsdelivr.net/npm/handsontable@12.1.0/dist/handsontable.full.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/SheetJS/0.18.10/xlsx.full.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h2>Excel Editor - Tabs</h2>
    
    <div class="toolbar">
        <button onclick="newFile()">New</button>
        <button onclick="openFile()">Open</button>
        <button onclick="saveFile()">Save</button>
        <button onclick="downloadFile()">Download</button>
        <button onclick="cutText()">Cut</button>
        <button onclick="copyText()">Copy</button>
        <button onclick="pasteText()">Paste</button>
        <button onclick="insertRow()">Insert Row</button>
        <button onclick="deleteRow()">Delete Row</button>
        <button onclick="findDuplicates()">Find Duplicates</button>
        <button onclick="sortTable()">Sort</button>
    </div>
    
    <div class="tab">
        <button id="main-tab">Main Sheet</button>
        <button id="business-tab">Business Approved List</button>
    </div>
    
    <div id="main-sheet" class="tab-content active">
        <h3>Main Sheet</h3>
        <div id="main-container"></div>
    </div>
    
    <div id="business-sheet" class="tab-content">
        <h3>Business Approved List</h3>
        <div id="business-container"></div>
    </div>
    
    <button id="save-excel">Save Changes</button>
    
    <script>
        var mainData = {{ main_data|safe }};
        var businessData = {{ business_data|safe }};

        // Ensure Main Sheet has at least 50-70 rows & 6 columns
        while (mainData.length < 50) {
            mainData.push(new Array(6).fill(""));
        }
        if (mainData.length > 70) {
            mainData = mainData.slice(0, 70);
        }

        // Ensure Business Approved List has at least 300 rows & 6 columns
        while (businessData.length < 300) {
            businessData.push(new Array(6).fill(""));
        }

        var mainContainer = document.getElementById('main-container');
        var businessContainer = document.getElementById('business-container');

        var mainHot = new Handsontable(mainContainer, {
            data: mainData,
            colHeaders: true,
            rowHeaders: true,
            manualColumnResize: true,
            manualRowResize: true,
            contextMenu: true,
            dropdownMenu: true,
            filters: true,
            height: 600,
            width: "100%",
            licenseKey: 'non-commercial-and-evaluation'
        });

        var businessHot = new Handsontable(businessContainer, {
            data: businessData,
            colHeaders: true,
            rowHeaders: true,
            manualColumnResize: true,
            manualRowResize: true,
            contextMenu: true,
            dropdownMenu: true,
            filters: true,
            height: 600,
            width: "100%",
            licenseKey: 'non-commercial-and-evaluation'
        });

        function newFile() {
            mainHot.loadData(new Array(50).fill(new Array(6).fill("")));
            businessHot.loadData(new Array(300).fill(new Array(6).fill("")));
        }
        function insertRow() { mainHot.alter('insert_row'); }
        function deleteRow() { mainHot.alter('remove_row'); }
        function cutText() { document.execCommand("cut"); }
        function copyText() { document.execCommand("copy"); }
        function pasteText() { document.execCommand("paste"); }
        function findDuplicates() { alert("Duplicate detection not implemented yet."); }
        function sortTable() { alert("Sorting not implemented yet."); }
        function openFile() { alert("Open functionality not implemented yet."); }
        function saveFile() { alert("Save functionality not implemented yet."); }
        function downloadFile() { alert("Download functionality not implemented yet."); }

        // Tab switching logic
        document.getElementById("main-tab").addEventListener("click", function () {
            document.getElementById("main-sheet").classList.add("active");
            document.getElementById("business-sheet").classList.remove("active");
        });

        document.getElementById("business-tab").addEventListener("click", function () {
            document.getElementById("business-sheet").classList.add("active");
            document.getElementById("main-sheet").classList.remove("active");
        });
    </script>
</body>
</html>
